#!/usr/bin/env bash
# .sh/bin/setup-www 20170519 - 20170522
# Copyright (C) 2015-2017 Mark Constable <markc@renta.net> (AGPL-3.0)

[[ -z $2 ]] && echo "Usage: setup-www user@domain|domain mysql|sqlite [user_pw] [mysql_pw] [shell_pw]" && exit 1

source ~/.sh/lib/defaults || exit 2

[[ ! -d $VPATH ]] && mkdir -p $VPATH

addvhost $*
addvmail admin@$VHOST

cd $UPATH/var

[[ -d www ]] && mv www www_old

git clone https://github.com/netserva/www

[[ -d www_old/public ]] && mv www_old/public www
[[ -d www_old/private ]] && mv www_old/private www

chperms $VHOST

echo "!!! Setup Netserva HCP -> http://$VHOST"
echo "
!!! Note: if the container has outside net access then use
\"newssl $VHOST\" to provide a LetsEncrypt SSL certificate.
"

systemd-cat -t hlog echo "$(whoami) $(basename $0) $*"
